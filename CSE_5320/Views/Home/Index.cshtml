@model CSE_5320.Models.Home.HomeModel
@{
    ViewBag.Title = "Dashboard";
}

<main role="main" class="container">
    <div class="d-flex align-items-center p-3 my-3 text-white-50 bg-purple rounded box-shadow">
        <div class="lh-100">
            <h6 class="mb-0 text-white lh-100">Asset Management</h6>
            <small>Inventory Management</small>
        </div>
    </div>

    <div class="alert alert-success" id="requestSent" role="alert">
        Asset request Sent
    </div>

    <div class="alert alert-warning" id="somethingWentWrong" role="alert">
        Something went wrong
    </div>

    <button type="button" class="btn btn-outline-primary" onclick="loadAssets('computer')">Request Computer</button>
    <button type="button" class="btn btn-outline-primary" onclick="loadAssets('software')">Request Software</button>

    <div class="align-items-center p-3 my-3 text-white-50 bg-primary rounded box-shadow">
        <div class="lh-100">
            <h6 class="mb-0 text-white lh-100">Assets Assigned</h6>
            <small>Below are a list of assets that have been assigned to you</small>
        </div>
    </div>

    <div class="my-3 p-3 bg-white rounded box-shadow">
        <div id="assetData_loader" class="loader"></div>
        <div id="assetData">
            @Html.Partial("PartialViews/_assetData", Model)
        </div>
    </div>

    <div class="align-items-center p-3 my-3 text-white-50 bg-dark rounded box-shadow">
        <div class="lh-100">
            <h6 class="mb-0 text-white lh-100">Assets History</h6>
            <small>Below is the history of asset requests</small>
        </div>
    </div>

    <div class="my-3 p-3 bg-white rounded box-shadow">
        <div id="assetDataHistory_loader" class="loader"></div>
        <div id="assetDataHistory">
            @Html.Partial("PartialViews/_assetData", Model)
        </div>
    </div>

</main>

<script>
    $(document).ready(function () {
        hideMessages();
        loadData();
    });

    function hideMessages() {
        $("#requestSent").hide();
        $("#somethingWentWrong").hide();
    }

    function loadData() {
        loadAssetRequests();
    }

    function loadAssetRequests() {
        $("#assetData").hide();
        $("#assetData_loader").show();

        $("#assetDataHistory").hide();
        $("#assetDataHistory_loader").show();

        var src = "@Url.Action("getUserAssetRequests", "Home", new { area = "" })";

        $.ajax({
            url: src,
            type: 'GET',
            cache: false,
            data: {}
        }).done(function(result) {
            $('#assetData').html(result);

            $("#assetData_loader").hide();
            $("#assetData").show();

            $("#assetDataHistory_loader").hide();
            $("#assetDataHistory").show();
         });
    }

    function loadAssets(type) {
      var src = '@Url.Action("loadAssets", "Home", new { area = "" })' + '?Type=' + type;

      $.ajax({
        type: "GET",
        url: src,
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        success: function (data) {
            hideMessages();
            $("#requestModalContainer").html(data.LocationModal);
            $('#requestModal').modal('show');
        },
        Error: function (data) {
            hideMessages();
            $("#somethingWentWrong").show();
            $('#requestModal').modal('hide');
        }
      });
    }

    function requestAsset(assetId) {
        var date_Id = '#requestDate_' + assetId;
        var toDate = $(date_Id).val();
          if (toDate == "") {
              alert("Enter the date till when you require the asset");
          }
          else {

              var d1 = new Date();
              var d2 = new Date(toDate);

              if (d1 > d2){
                  alert("Cannot enter a day in the past");
              }
              else {
                  var src = '@Url.Action("RequestAsset", "Asset", new { area = "" })' + '?assetId=' + assetId + '&toDate=' + toDate;

                  $.ajax({
                    type: "POST",
                    url: src,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        $('#requestModal').modal('hide');
                        $('#requestSent').show();
                    },
                    Error: function (data) {
                        hideMessages();
                        $("#somethingWentWrong").show();
                        $('#requestModal').modal('hide');
                    }
                  });
              }
          }
    }

    function loadInfo(Id) {
      var src = '@Url.Action("Assetinfo", "Home", new { area = "" })'+ '?Id='+Id;

      $.ajax({
        type: "GET",
        url: src,
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        success: function (data) {
            hideMessages();
            $("#assetModalContainer").html(data.LocationModal);
            $('#assetModal').modal('show');
        },
        Error: function (data) {
            hideMessages();
            $("#somethingWentWrong").show();
            $('#assetModal').modal('hide');
        }
      });
    }
</script>

<div id="requestModalContainer"></div>
<div id="assetModalContainer"></div>